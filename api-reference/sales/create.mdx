---
title: "Criar Venda"
api: "POST /api/v1/sales"
description: "Registra uma nova venda com múltiplos itens"
---

<Tip>
Cria uma nova venda no sistema. O valor total é calculado automaticamente com base nos itens. Se não fornecer um código de pedido, será gerado automaticamente.
</Tip>

<Warning>
Você precisa de uma API key válida no header x-api-key para usar este endpoint.
</Warning>

<Note>
**Cálculo Automático**: O valor total da venda é calculado automaticamente somando (quantidade × valor unitário) de cada item.
</Note>

## Headers

<ParamField header="Content-Type" type="string" required>
  application/json
</ParamField>

<ParamField header="x-api-key" type="string" required>
  API key de autenticação
</ParamField>

## Body

### Informações da Venda

<ParamField body="clienteId" type="string" required>
  ID do cliente (UUID)
  
  Deve ser um cliente cadastrado e ativo
</ParamField>

<ParamField body="representadaId" type="string" required>
  ID da representada (UUID)
  
  Deve ser uma representada cadastrada
</ParamField>

<ParamField body="status" type="string" required>
  Status inicial da venda
  
  Valores aceitos:
  - `Pedido` - Venda registrada
  - `Faturado` - Nota fiscal emitida
  - `Enviado` - Mercadoria despachada
  - `Entregue` - Mercadoria recebida
  - `Cancelado` - Venda cancelada
</ParamField>

<ParamField body="data" type="string">
  Data da venda no formato YYYY-MM-DD
  
  Se não fornecida, usa a data atual
</ParamField>

<ParamField body="pedido" type="string">
  Código do pedido
  
  Se não fornecido, gera automaticamente no formato: PED-YYYY-XXXX
</ParamField>

### Itens da Venda

<ParamField body="itens" type="array" required>
  Lista de produtos vendidos
  
  <Expandable title="Estrutura do item">
    <ParamField body="produtoId" type="string" required>
      ID do produto (pode ser qualquer identificador)
    </ParamField>
    <ParamField body="quantidade" type="number" required>
      Quantidade vendida
      
      Deve ser maior que zero
    </ParamField>
    <ParamField body="valorUnitario" type="number" required>
      Valor unitário do produto em reais
      
      Deve ser maior que zero
    </ParamField>
  </Expandable>
</ParamField>

<RequestExample>

```bash Venda Simples
curl -X POST https://api.sistema-representantes.com.br/api/v1/sales \
  -H "Content-Type: application/json" \
  -H "x-api-key: sua-api-key-aqui" \
  -d '{
    "clienteId": "123e4567-e89b-12d3-a456-426614174000",
    "representadaId": "987e6543-e89b-12d3-a456-426614174999",
    "status": "Pedido",
    "itens": [
      {
        "produtoId": "QUEIJO-MUSSARELA",
        "quantidade": 10,
        "valorUnitario": 45.90
      }
    ]
  }'
```

```bash Múltiplos Itens
curl -X POST https://api.sistema-representantes.com.br/api/v1/sales \
  -H "Content-Type: application/json" \
  -H "x-api-key: sua-api-key-aqui" \
  -d '{
    "clienteId": "123e4567-e89b-12d3-a456-426614174000",
    "representadaId": "987e6543-e89b-12d3-a456-426614174999",
    "status": "Pedido",
    "data": "2024-01-25",
    "pedido": "PED-ESPECIAL-001",
    "itens": [
      {
        "produtoId": "QUEIJO-MUSSARELA",
        "quantidade": 20,
        "valorUnitario": 45.90
      },
      {
        "produtoId": "QUEIJO-PRATO",
        "quantidade": 15,
        "valorUnitario": 42.50
      },
      {
        "produtoId": "REQUEIJAO-200G",
        "quantidade": 30,
        "valorUnitario": 8.90
      }
    ]
  }'
```

```javascript JavaScript
const saleData = {
  clienteId: "123e4567-e89b-12d3-a456-426614174000",
  representadaId: "987e6543-e89b-12d3-a456-426614174999",
  status: "Pedido",
  itens: [
    {
      produtoId: "PROD-001",
      quantidade: 50,
      valorUnitario: 25.00
    },
    {
      produtoId: "PROD-002",
      quantidade: 30,
      valorUnitario: 35.50
    }
  ]
};

const response = await fetch('https://api.sistema-representantes.com.br/api/v1/sales', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'x-api-key': 'sua-api-key-aqui'
  },
  body: JSON.stringify(saleData)
});

const result = await response.json();

if (result.success) {
  console.log(`Venda criada: ${result.data.pedido}`);
  console.log(`Valor total: R$ ${result.data.valor_total.toFixed(2)}`);
  
  // Listar itens
  result.data.itens.forEach(item => {
    console.log(`- ${item.produto_id}: ${item.quantidade}x R$ ${item.valor_unitario} = R$ ${item.valor_total}`);
  });
} else {
  console.error('Erro:', result.error);
}
```

```python Python
import requests
import json
from datetime import date

url = "https://api.sistema-representantes.com.br/api/v1/sales"
headers = {
    'Content-Type': 'application/json',
    'x-api-key': 'sua-api-key-aqui'
}

# Venda com data específica
data = {
    "clienteId": "123e4567-e89b-12d3-a456-426614174000",
    "representadaId": "987e6543-e89b-12d3-a456-426614174999",
    "status": "Faturado",
    "data": date.today().strftime("%Y-%m-%d"),
    "itens": [
        {
            "produtoId": "LEITE-INTEGRAL-1L",
            "quantidade": 100,
            "valorUnitario": 4.50
        },
        {
            "produtoId": "MANTEIGA-200G",
            "quantidade": 50,
            "valorUnitario": 12.90
        },
        {
            "produtoId": "IOGURTE-170G",
            "quantidade": 200,
            "valorUnitario": 3.20
        }
    ]
}

response = requests.post(url, headers=headers, json=data)
result = response.json()

if response.status_code == 201:
    print(f"Venda registrada com sucesso!")
    print(f"Pedido: {result['data']['pedido']}")
    print(f"Data: {result['data']['data']}")
    print(f"Valor Total: R$ {result['data']['valor_total']:.2f}")
    print("\nItens:")
    for item in result['data']['itens']:
        print(f"- {item['produto_id']}: {item['quantidade']} un x R$ {item['valor_unitario']:.2f} = R$ {item['valor_total']:.2f}")
else:
    print(f"Erro: {result.get('error', 'Erro desconhecido')}")
```

```php PHP
<?php
$url = 'https://api.sistema-representantes.com.br/api/v1/sales';
$headers = [
    'Content-Type: application/json',
    'x-api-key: sua-api-key-aqui'
];

// Venda com múltiplos produtos
$data = [
    'clienteId' => '123e4567-e89b-12d3-a456-426614174000',
    'representadaId' => '987e6543-e89b-12d3-a456-426614174999',
    'status' => 'Pedido',
    'itens' => [
        [
            'produtoId' => 'BEBIDA-LACTEA-1L',
            'quantidade' => 48,
            'valorUnitario' => 3.90
        ],
        [
            'produtoId' => 'CREAM-CHEESE-150G',
            'quantidade' => 24,
            'valorUnitario' => 9.50
        ]
    ]
];

$options = [
    'http' => [
        'header' => implode("\r\n", $headers),
        'method' => 'POST',
        'content' => json_encode($data)
    ]
];

$context = stream_context_create($options);
$result = file_get_contents($url, false, $context);
$response = json_decode($result, true);

if (isset($response['success']) && $response['success']) {
    echo "Venda registrada com sucesso!\n";
    echo "Pedido: " . $response['data']['pedido'] . "\n";
    echo "Valor Total: R$ " . number_format($response['data']['valor_total'], 2, ',', '.') . "\n";
    echo "\nItens da venda:\n";
    foreach ($response['data']['itens'] as $item) {
        echo sprintf("- %s: %d x R$ %.2f = R$ %.2f\n", 
            $item['produto_id'],
            $item['quantidade'],
            $item['valor_unitario'],
            $item['valor_total']
        );
    }
} else {
    echo "Erro: " . $response['error'] . "\n";
}
?>
```

</RequestExample>

## Response

### Sucesso

<ResponseField name="success" type="boolean">
  Indica se a operação foi bem-sucedida
</ResponseField>

<ResponseField name="data" type="object">
  Dados da venda criada
  
  <Expandable title="Estrutura da venda">
    <ResponseField name="id" type="string">
      ID único da venda (UUID)
    </ResponseField>
    <ResponseField name="pedido" type="string">
      Código do pedido (gerado automaticamente se não fornecido)
    </ResponseField>
    <ResponseField name="data" type="string">
      Data da venda (formato: YYYY-MM-DD)
    </ResponseField>
    <ResponseField name="cliente_id" type="string">
      ID do cliente
    </ResponseField>
    <ResponseField name="representada_id" type="string">
      ID da representada
    </ResponseField>
    <ResponseField name="status" type="string">
      Status da venda
    </ResponseField>
    <ResponseField name="valor_total" type="number">
      Valor total calculado automaticamente
    </ResponseField>
    <ResponseField name="itens" type="array">
      Lista de itens da venda
      
      <Expandable title="Estrutura do item">
        <ResponseField name="produto_id" type="string">
          ID do produto
        </ResponseField>
        <ResponseField name="quantidade" type="number">
          Quantidade vendida
        </ResponseField>
        <ResponseField name="valor_unitario" type="number">
          Valor unitário
        </ResponseField>
        <ResponseField name="valor_total" type="number">
          Valor total do item (quantidade × valor unitário)
        </ResponseField>
      </Expandable>
    </ResponseField>
    <ResponseField name="created_at" type="string">
      Data de criação (ISO 8601)
    </ResponseField>
  </Expandable>
</ResponseField>

### Erro

<ResponseField name="error" type="string">
  Mensagem de erro descritiva
</ResponseField>

<ResponseExample>

```json 201 - Criado com Sucesso
{
  "success": true,
  "data": {
    "id": "789e0123-e89b-12d3-a456-426614174222",
    "pedido": "PED-2024-003",
    "data": "2024-01-25",
    "cliente_id": "123e4567-e89b-12d3-a456-426614174000",
    "representada_id": "987e6543-e89b-12d3-a456-426614174999",
    "status": "Pedido",
    "valor_total": 1824.50,
    "itens": [
      {
        "produto_id": "QUEIJO-MUSSARELA",
        "quantidade": 20,
        "valor_unitario": 45.90,
        "valor_total": 918.00
      },
      {
        "produto_id": "QUEIJO-PRATO",
        "quantidade": 15,
        "valor_unitario": 42.50,
        "valor_total": 637.50
      },
      {
        "produto_id": "REQUEIJAO-200G",
        "quantidade": 30,
        "valor_unitario": 8.90,
        "valor_total": 267.00
      }
    ],
    "created_at": "2024-01-25T14:30:00Z"
  }
}
```

```json 400 - Erro de Validação
{
  "error": "Dados de entrada inválidos",
  "details": {
    "clienteId": "Campo obrigatório",
    "itens": "Deve conter pelo menos um item"
  }
}
```

```json 400 - Cliente Inválido
{
  "error": "Cliente não encontrado ou inativo"
}
```

```json 400 - Item Inválido
{
  "error": "Quantidade deve ser maior que zero"
}
```

```json 401 - Não Autorizado
{
  "error": "API key ausente"
}
```

```json 403 - Empresa Inativa
{
  "error": "Empresa inativa"
}
```

</ResponseExample>

## Validações

<Warning>
O sistema aplica as seguintes validações:

**Campos obrigatórios:**
- `clienteId`: Deve existir e estar ativo
- `representadaId`: Deve existir
- `status`: Deve ser um status válido
- `itens`: Array com pelo menos um item

**Validações dos itens:**
- `produtoId`: Obrigatório
- `quantidade`: Maior que zero
- `valorUnitario`: Maior que zero

**Validações adicionais:**
- Cliente deve pertencer à mesma empresa da API key
- Data não pode ser futura
</Warning>

## Códigos de Pedido

<Info>
Se o campo `pedido` não for fornecido, o sistema gera automaticamente:
- Formato: `PED-YYYY-XXXX`
- YYYY = Ano atual
- XXXX = Número sequencial
- Exemplos: PED-2024-0001, PED-2024-0002...
- O código é único por empresa
</Info>

## Cálculo de Valores

<Note>
**Cálculo Automático do Valor Total:**

O sistema calcula automaticamente:
1. Valor total de cada item: `quantidade × valorUnitario`
2. Valor total da venda: soma de todos os itens

Exemplo:
```
Item 1: 10 × R$ 45,90 = R$ 459,00
Item 2: 5 × R$ 32,50 = R$ 162,50
Total da Venda: R$ 621,50
```

Não é necessário (nem possível) enviar o valor total - ele sempre será calculado pelo sistema.
</Note>