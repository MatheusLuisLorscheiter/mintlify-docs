---
title: Tratamento de Erros
description: Como lidar com erros e respostas de erro da API
---

# Tratamento de Erros

A API do Sistema de Representantes usa códigos de status HTTP convencionais para indicar o sucesso ou falha de uma requisição.

## Códigos de Status

### Sucessos (2xx)

| Código | Significado |
|--------|-------------|
| `200` | OK - Requisição processada com sucesso |
| `201` | Created - Recurso criado com sucesso |

### Erros do Cliente (4xx)

| Código | Significado |
|--------|-------------|
| `400` | Bad Request - Requisição inválida ou malformada |
| `401` | Unauthorized - Falha na autenticação |
| `403` | Forbidden - Acesso negado ao recurso |
| `404` | Not Found - Recurso não encontrado |
| `422` | Unprocessable Entity - Dados de entrada inválidos |
| `429` | Too Many Requests - Limite de rate excedido |

### Erros do Servidor (5xx)

| Código | Significado |
|--------|-------------|
| `500` | Internal Server Error - Erro interno do servidor |
| `502` | Bad Gateway - Erro de gateway |
| `503` | Service Unavailable - Serviço temporariamente indisponível |

## Formato de Resposta de Erro

Todas as respostas de erro seguem um formato consistente:

```json
{
  "error": "Descrição do erro em português",
  "code": "ERROR_CODE",
  "details": {
    // Detalhes adicionais quando aplicável
  }
}
```

## Exemplos de Erros Comuns

### Erro de Validação

```json
{
  "error": "Dados de entrada inválidos",
  "code": "VALIDATION_ERROR",
  "details": {
    "nome": "Campo obrigatório",
    "email": "Formato de email inválido"
  }
}
```

### Erro de Autenticação

```json
{
  "error": "API key inválida",
  "code": "INVALID_API_KEY"
}
```

### Erro de Rate Limit

```json
{
  "error": "Limite de requisições excedido",
  "code": "RATE_LIMIT_EXCEEDED",
  "details": {
    "limit": 1000,
    "remaining": 0,
    "reset_at": "2024-01-20T15:00:00Z"
  }
}
```

## Tratamento de Erros por Linguagem

<CodeGroup>

```javascript JavaScript
async function makeApiRequest() {
  try {
    const response = await fetch('https://api.sistema-representantes.com.br/api/v1/clients', {
      headers: {
        'x-api-key': process.env.API_KEY
      }
    });

    if (!response.ok) {
      const error = await response.json();
      
      switch (response.status) {
        case 401:
          console.error('Erro de autenticação:', error.error);
          // Renovar token ou redirecionar para login
          break;
        case 429:
          console.error('Rate limit excedido, tentar novamente em:', error.details.reset_at);
          // Implementar retry com backoff
          break;
        default:
          console.error('Erro na API:', error.error);
      }
      
      throw new Error(error.error);
    }

    return await response.json();
  } catch (error) {
    console.error('Erro na requisição:', error);
    throw error;
  }
}
```

```python Python
import requests
from time import sleep

def make_api_request_with_retry(url, headers, max_retries=3):
    for attempt in range(max_retries):
        try:
            response = requests.get(url, headers=headers)
            
            if response.status_code == 200:
                return response.json()
            
            error_data = response.json()
            
            if response.status_code == 429:
                # Rate limit - aguardar antes de tentar novamente
                retry_after = error_data.get('details', {}).get('retry_after', 60)
                print(f"Rate limit atingido. Aguardando {retry_after} segundos...")
                sleep(retry_after)
                continue
                
            elif response.status_code == 401:
                raise Exception(f"Erro de autenticação: {error_data['error']}")
                
            else:
                raise Exception(f"Erro na API: {error_data['error']}")
                
        except requests.exceptions.RequestException as e:
            print(f"Erro de conexão (tentativa {attempt + 1}/{max_retries}): {e}")
            if attempt < max_retries - 1:
                sleep(2 ** attempt)  # Backoff exponencial
            else:
                raise
```

```php PHP
<?php
function makeApiRequest($endpoint, $apiKey) {
    $maxRetries = 3;
    $attempt = 0;
    
    while ($attempt < $maxRetries) {
        $ch = curl_init();
        
        curl_setopt($ch, CURLOPT_URL, "https://api.sistema-representantes.com.br/api/v1/" . $endpoint);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, [
            'x-api-key: ' . $apiKey,
            'Content-Type: application/json'
        ]);
        
        $response = curl_exec($ch);
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        curl_close($ch);
        
        if ($httpCode === 200 || $httpCode === 201) {
            return json_decode($response, true);
        }
        
        $error = json_decode($response, true);
        
        switch ($httpCode) {
            case 429:
                // Rate limit - aguardar
                $retryAfter = $error['details']['retry_after'] ?? 60;
                sleep($retryAfter);
                $attempt++;
                break;
                
            case 401:
                throw new Exception("Erro de autenticação: " . $error['error']);
                
            default:
                throw new Exception("Erro na API: " . $error['error']);
        }
    }
    
    throw new Exception("Máximo de tentativas excedido");
}
?>
```

</CodeGroup>

## Boas Práticas

### 1. Sempre Verifique o Status HTTP

Não assuma que a requisição foi bem-sucedida. Sempre verifique o código de status.

### 2. Implemente Retry com Backoff

Para erros temporários (5xx) ou rate limit (429), implemente retry com backoff exponencial.

### 3. Log de Erros Detalhado

Registre todos os detalhes do erro para facilitar a depuração:

```javascript
console.error({
  timestamp: new Date().toISOString(),
  endpoint: '/api/v1/clients',
  status: response.status,
  error: errorData,
  requestId: response.headers.get('x-request-id')
});
```

### 4. Tratamento Gracioso

Sempre forneça feedback apropriado ao usuário:

```javascript
function getUserFriendlyMessage(error) {
  const messages = {
    'INVALID_API_KEY': 'Credenciais inválidas. Por favor, verifique suas configurações.',
    'RATE_LIMIT_EXCEEDED': 'Muitas requisições. Por favor, aguarde um momento.',
    'VALIDATION_ERROR': 'Por favor, verifique os dados informados.',
    'SERVER_ERROR': 'Erro temporário. Por favor, tente novamente.'
  };
  
  return messages[error.code] || 'Ocorreu um erro. Por favor, tente novamente.';
}
```

## Debug e Suporte

### Headers de Debug

A API retorna headers úteis para debug:

- `x-request-id`: ID único da requisição para rastreamento
- `x-rate-limit-remaining`: Requisições restantes
- `x-rate-limit-reset`: Quando o limite será resetado

### Contato para Suporte

Se encontrar erros persistentes:

1. Verifique o status da API em https://status.sistema-representantes.com.br
2. Consulte a documentação completa
3. Entre em contato com suporte@sistema-representantes.com.br incluindo:
   - Request ID (header `x-request-id`)
   - Endpoint e método HTTP
   - Corpo da requisição (sem dados sensíveis)
   - Resposta de erro completa